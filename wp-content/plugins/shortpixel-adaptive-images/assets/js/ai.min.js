function SPAI(){}SPAI.prototype={stop:1e5,fancyboxId:"",fancyboxHooked:"none",mutationsCount:0,mutationsList:{},timeOutHandle:false,mutationsLastProcessed:0,updatedUrlsCount:0,mutationObserver:false,intersectionObserver:false,intersectionMargin:500,initialized:false,bodyHandled:false,bodyCount:0,supportsWebP:false,urlRegister:[],callbacks:[],sniperOn:false,debugInfo:{log:""},loadTs:Date.now(),NORESIZE:1,EXCLUDED:2,EAGER:4};SPAI.prototype.init=function(){if(typeof window.IntersectionObserver!=="function"){jQuery.getScript(spai_settings.plugin_url+"/assets/js/intersection.min.js?"+spai_settings.version,ShortPixelAI.setupIntersectionObserverAndParse)}else{ShortPixelAI.setupIntersectionObserverAndParse()}};SPAI.prototype.record=function(e,t,r){if(spai_settings.debug){switch(e){case"count":if(typeof ShortPixelAI.debugInfo[t]==="undefined")ShortPixelAI.debugInfo[t]=0;ShortPixelAI.debugInfo[t]+=r;break;case"log":case"logX":if(typeof ShortPixelAI.debugInfo[t]==="undefined")ShortPixelAI.debugInfo[t]="";ShortPixelAI.debugInfo[t]+=(new Date).getTime()+" - "+(e==="log"?r:ShortPixelAI.xpath(r))+"\n"}}};SPAI.prototype.gLog=function(e){if(arguments.length===0){return}var t=Date.now()-this.loadTs;console.groupCollapsed("ðŸ¤– SPAI Debug");console.log("%cTime after init: %c"+t+"%c ms","font-weight:bold","color:#4caf50;font-weight:bold","color:inherit;font-weight:bold");for(var r=0;r<arguments.length;r++){console.log(arguments[r])}console.groupEnd()};SPAI.prototype.log=function(e){var t=Date.now()-ShortPixelAI.loadTs;var r=t+"ms - "+e;if(t<2e3){ShortPixelAI.debugInfo["log"]+=r+"\n";return}if(ShortPixelAI.debugInfo["log"]!==""){console.log(ShortPixelAI.debugInfo["log"]);ShortPixelAI.debugInfo["log"]=""}console.log(r)};SPAI.prototype.handleBody=function(){var e=jQuery("body");ShortPixelAI.bodyCount=1;try{ShortPixelAI.handleUpdatedImageUrls(true,e,true,false);ShortPixelAI.bodyHandled=true;ShortPixelAI.triggerEvent("spai-body-handled",e[0])}catch(e){if(e=="defer_all"&&ShortPixelAI.bodyCount<20){setTimeout(ShortPixelAI.handleBody,20*ShortPixelAI.bodyCount);ShortPixelAI.bodyCount++}else{spai_settings.debug&&ShortPixelAI.log("handleBody - error "+e);throw e}}};SPAI.prototype.handleUpdatedImageUrlsWithRetry=function(e,t,r,i){try{ShortPixelAI.handleUpdatedImageUrls(e,t,r,i)}catch(o){if(o=="defer_all"&&ShortPixelAI.bodyCount<30){spai_settings.debug&&ShortPixelAI.log("handleUpdatedImageUrlsWRetry - DEFER ALL");setTimeout((function(){ShortPixelAI.handleUpdatedImageUrls(e,t,r,i)}),20*ShortPixelAI.bodyCount);ShortPixelAI.bodyCount++}else{spai_settings.debug&&ShortPixelAI.log("handleUpdatedImageUrlsWRetry - error "+o.description);throw o}}};SPAI.prototype.handleUpdatedImageUrls=function(e,t,r,i){if(!e&&!ShortPixelAI.bodyHandled){return}if(t.is("img,amp-img")){ShortPixelAI.updateImageUrl(t,r,i);return}ShortPixelAI.updatedUrlsCount=0;jQuery("img,amp-img",t).each((function(){var e=jQuery(this);ShortPixelAI.updateImageUrl(e,r,i)}));var o=spai_settings.affected_tags!=="{{SPAI-AFFECTED-TAGS}}"?JSON.parse(spai_settings.affected_tags):typeof spai_affectedTags!=="undefined"?JSON.parse(spai_affectedTags):{};if(i){for(var a in o){if(t.is(a)){ShortPixelAI.updateDivUrl(t,r,i);break}}}var n="";for(var a in o){n+=","+a}n=n.replace(/^,/,"");jQuery(n,t).each((function(){var e=jQuery(this);if(e[0].tagName==="VIDEO"){ShortPixelAI.updateVideoPoster(e,r)}else{ShortPixelAI.updateDivUrl(e,r,i)}}));ShortPixelAI.updateAHrefForIntegration("CORE",t,"a.media-gallery-link");ShortPixelAI.updateAHrefForIntegration("envira",t,"a.envira-gallery-link");ShortPixelAI.updateAHrefForIntegration("modula",t,"div.modula-gallery a[data-lightbox]");ShortPixelAI.updateAHrefForIntegration("elementor-addons",t,"div.eael-filter-gallery-wrapper a.eael-magnific-link");ShortPixelAI.updateAHrefForIntegration("elementor",t,"a[data-elementor-open-lightbox]");ShortPixelAI.updateAHrefForIntegration("viba-portfolio",t,"a.viba-portfolio-media-link");if(spai_settings.active_integrations["wp-bakery"]){jQuery("span.dima-testimonial-image",t).each((function(){ShortPixelAI.updateWpBakeryTestimonial(jQuery(this),r)}))}if(spai_settings.active_integrations["social-pug"]){jQuery("a.dpsp-pin-it-button",t).each((function(){var e=jQuery(this);var t=false;e.attr("href",e.attr("href").replace(/media=(data:image\/svg\+xml;.*)&url=/,(function(e,r,i){t=true;return"media="+ShortPixelAI.parsePseudoSrc(r).src+"&url="})));if(!t){var r=spai_settings.api_url.substr(0,spai_settings.api_url.lastIndexOf("/")+1).replace("/","\\/")+"[^\\/]+\\/";e.attr("href",e.attr("href").replace(new RegExp(r),""))}}))}ShortPixelAI.updateAHrefForIntegration("foo",t,"div.fg-item a.fg-thumb");if(spai_settings.active_integrations.nextgen){jQuery("a.ngg-fancybox, a.ngg-simplelightbox",t).each((function(){var e=jQuery(this);if(!ShortPixelAI.isFullPseudoSrc(e.attr("href"))){return}var t=ShortPixelAI.parsePseudoSrc(e.attr("href"));e.attr("href",ShortPixelAI.composeApiUrl(false,t.src,"DEFER",false));if(e.hasClass("ngg-fancybox")){e.mousedown((function(){ShortPixelAI.fancyboxUpdateWidth(e);return true}))}}))}if(ShortPixelAI.updatedUrlsCount>0){spai_settings.debug&&ShortPixelAI.log("trigger spai-block-handled event for "+ShortPixelAI.updatedUrlsCount+" URLs on "+t[0].tagName);ShortPixelAI.triggerEvent("spai-block-handled",t[0])}};SPAI.prototype.updateImageUrl=function(e,t,r){if(!ShortPixelAI.containsPseudoSrc(e[0].outerHTML)){return}if(typeof e.attr("data-spai-upd")!=="undefined"){return}var i=ShortPixelAI.is(e,ShortPixelAI.EXCLUDED|ShortPixelAI.EAGER|ShortPixelAI.NORESIZE);if(spai_settings.native_lazy=="1"){i|=ShortPixelAI.EAGER}if(!(i&ShortPixelAI.EAGER)&&!r&&!ShortPixelAI.elementInViewport(e[0],ShortPixelAI.intersectionMargin)){ShortPixelAI.intersectionObserver.observe(e[0]);return}var o=0,a=0,n=0,s=0;if((i&(ShortPixelAI.EXCLUDED|ShortPixelAI.NORESIZE))==0){try{var l=ShortPixelAI.getSizesRecursive(e,t);o=l.width;a=l.height;n=Math.round(o+l.padding);s=Math.round(a+l.padding_height)}catch(r){if(!e[0].complete){throw"defer_all"}if(typeof r.type!=="undefined"&&r.type=="defer"&&t&&!(i&ShortPixelAI.EAGER)){spai_settings.debug&&ShortPixelAI.log("Defer "+r.cause+" "+ShortPixelAI.parsePseudoSrc(e[0].src).src);if(!e.is(":visible")&&!!spai_settings.hover_handling){spai_settings.debug&&ShortPixelAI.log("Attach mouseover to it");e.off("mouseover",ShortPixelAI.mouseOverHandler);e.on("mouseover",ShortPixelAI.mouseOverHandler)}return}}}ShortPixelAI.record("count","modifiedImg",1);ShortPixelAI.record("logX","modifiedImgURL",e[0]);if(n&&e.attr("width")&&n<e.attr("width")){if(e.attr("height")){e.attr("height",Math.round(e.attr("height")*n/e.attr("width")))}e.attr("width",n)}else if(s&&e.attr("height")&&s<e.attr("height")){e.attr("height",s)}var d=ShortPixelAI.updateSrc(e,"src",o,a,(spai_settings.method=="src"||spai_settings.method=="both")&&(i&ShortPixelAI.EXCLUDED)==0);ShortPixelAI.updateSrc(e,"data-src",false,false,(i&ShortPixelAI.EXCLUDED)==0);ShortPixelAI.updateSrc(e,"data-large_image",false,false,(i&ShortPixelAI.EXCLUDED)==0);if(spai_settings.active_integrations.envira){ShortPixelAI.updateSrc(e,"data-envira-src",false,false,(i&ShortPixelAI.EXCLUDED)==0);ShortPixelAI.updateSrc(e,"data-safe-src",o,a,(i&ShortPixelAI.EXCLUDED)==0)}if(spai_settings.active_integrations.foo){ShortPixelAI.updateSrc(e,"data-src-fg",o,a,(i&ShortPixelAI.EXCLUDED)==0)}if(spai_settings.method=="src"){ShortPixelAI.removeSrcSet(e)}else{ShortPixelAI.updateSrcSet(e,o,d)}if(spai_settings.native_lazy=="1"){e.attr("loading","lazy")}ShortPixelAI.elementUpdated(e,o);e.off("mouseover",ShortPixelAI.mouseOverHandler)};SPAI.prototype.mouseOverHandler=function(){var e=jQuery(this);spai_settings.debug&&ShortPixelAI.log("Mouseover triggered on "+ShortPixelAI.parsePseudoSrc(this.src).src);if(e.is(":visible")){spai_settings.debug&&ShortPixelAI.log("updateImageURL");var t=e.width(),r=e.height();ShortPixelAI.updateImageUrl(e,true,true)}};SPAI.prototype.updateWpBakeryTestimonial=function(e,t){if(typeof e.attr("data-spai-upd")!=="undefined"){return}ShortPixelAI.updateAttr(e,"data-element-bg");var r=0,i=0,o=[];var a=ShortPixelAI.is(e,ShortPixelAI.EXCLUDED|ShortPixelAI.NORESIZE|ShortPixelAI.EAGER);if((a&(ShortPixelAI.EXCLUDED|ShortPixelAI.NORESIZE))==0){try{o=ShortPixelAI.getSizesRecursive(e,t);r=o.width;i=o.height}catch(e){if(typeof e.type!=="undefined"&&e.type=="defer"&&t&&!(a&ShortPixelAI.EAGER)){return}}}ShortPixelAI.updateInlineStyle(e,r,i,(a&ShortPixelAI.EXCLUDED)==0);ShortPixelAI.elementUpdated(e,r)};SPAI.prototype.updateVideoPoster=function(e,t){if(typeof e.attr("data-spai-upd")!=="undefined"){return}var r=0,i=0,o=[];var a=ShortPixelAI.is(e,ShortPixelAI.EXCLUDED|ShortPixelAI.NORESIZE|ShortPixelAI.EAGER);if((a&(ShortPixelAI.EXCLUDED|ShortPixelAI.NORESIZE))==0){try{o=ShortPixelAI.getSizesRecursive(e,t);r=o.width;i=o.height}catch(e){if(typeof e.type!=="undefined"&&e.type=="defer"&&t&&!(a&ShortPixelAI.EAGER)){return}}}ShortPixelAI.updateSrc(e,"poster",r,i,(a&ShortPixelAI.EXCLUDED)==0);ShortPixelAI.elementUpdated(e,r)};SPAI.prototype.updateDivUrl=function(e,t,r){if(typeof e.attr("data-spai-upd")!=="undefined"){return}if(typeof e.attr("src")==="undefined"&&typeof e.attr("data-src")==="undefined"&&typeof e.attr("data-thumb")==="undefined"&&!ShortPixelAI.getBackgroundPseudoImages(e.attr("style"))){return}if(!r&&!ShortPixelAI.elementInViewport(e[0],ShortPixelAI.intersectionMargin)){ShortPixelAI.intersectionObserver.observe(e[0]);return}var i=0,o=0,a=[];var n=ShortPixelAI.is(e,ShortPixelAI.EXCLUDED|ShortPixelAI.NORESIZE|ShortPixelAI.EAGER);if((n&(ShortPixelAI.EXCLUDED|ShortPixelAI.NORESIZE))==0){try{a=ShortPixelAI.getSizesRecursive(e,t);i=a.width;o=a.height}catch(e){if(typeof e.type!=="undefined"&&e.type=="defer"&&t&&!(n&ShortPixelAI.EAGER)){return}}}ShortPixelAI.updateSrc(e,"src",i,o,(n&ShortPixelAI.EXCLUDED)==0);ShortPixelAI.updateSrc(e,"data-src",i,o,(n&ShortPixelAI.EXCLUDED)==0);ShortPixelAI.updateSrc(e,"data-thumb",false,false,(n&ShortPixelAI.EXCLUDED)==0);ShortPixelAI.updateInlineStyle(e,i,o,(n&ShortPixelAI.EXCLUDED)==0);ShortPixelAI.elementUpdated(e,i)};SPAI.prototype.updateAHref=function(e,t,r){ShortPixelAI.updateAttr(e,"href")};SPAI.prototype.updateAttr=function(e,t){if(typeof e.attr("data-spai-upd")!=="undefined"){return}if(typeof e.attr(t)==="undefined"){return}var r=ShortPixelAI.updateSrc(e,t,window.screen.availWidth,window.screen.availHeight,!ShortPixelAI.is(e,ShortPixelAI.EXCLUDED),true);ShortPixelAI.elementUpdated(e,r.newWidth)};SPAI.prototype.is=function(e,t){var r=0;if(t|ShortPixelAI.EAGER){for(var i=0;i<spai_settings.eager_selectors.length;i++){var o=spai_settings.eager_selectors[i];try{if(e.is(o))r|=ShortPixelAI.EAGER}catch(e){spai_settings.debug&&ShortPixelAI.log("eager:"+e.message)}}}if(t|ShortPixelAI.EXCLUDED){for(var i=0;i<spai_settings.excluded_selectors.length;i++){var o=spai_settings.excluded_selectors[i];try{if(e.is(o))r|=ShortPixelAI.EXCLUDED}catch(e){spai_settings.debug&&ShortPixelAI.log("excluded:"+e.message)}}}if(t|ShortPixelAI.NORESIZE){for(var i=0;i<spai_settings.noresize_selectors.length;i++){var o=spai_settings.noresize_selectors[i];try{if(e.is(o))r|=ShortPixelAI.NORESIZE}catch(e){spai_settings.debug&&ShortPixelAI.log("noresize:"+e.message)}}}return r};SPAI.prototype.updateAHrefForIntegration=function(e,t,r){if(e=="CORE"||spai_settings.active_integrations[e]){jQuery(r,t).each((function(){var e=jQuery(this);ShortPixelAI.updateAHref(e)}))}};SPAI.prototype.setupDOMChangeObserver=function(){ShortPixelAI.mutationObserver=new MutationObserver((function(e){if(ShortPixelAI.sniperOn)return;e.forEach((function(e){if(e.type==="attributes"&&e.attributeName==="id"){return}if(e.addedNodes.length){for(var t=0;t<e.addedNodes.length;t++){try{ShortPixelAI.handleUpdatedImageUrls(false,jQuery(e.addedNodes[t]),true,false)}catch(e){if(e=="defer_all"){setTimeout(ShortPixelAI.handleBody,20*ShortPixelAI.bodyCount)}else{throw e}}}}if(e.type=="attributes"){var r=e.target.getAttribute("class");r=typeof r==="undefined"||r===null?"":r;if(e.target.nodeName==="BODY"&&ShortPixelAI.containsPseudoSrc(r)>0){return}if(jQuery(e.target).attr("id")=="fancybox-wrap"&&ShortPixelAI.fancyboxId!=ShortPixelAI.fancyboxHooked){ShortPixelAI.hookIntoFancybox(e.target)}else{if(ShortPixelAI.timeOutHandle){clearTimeout(ShortPixelAI.timeOutHandle);if((new Date).getTime()-ShortPixelAI.mutationsLastProcessed>100){ShortPixelAI.processMutations()}}else{ShortPixelAI.mutationsLastProcessed=(new Date).getTime()}ShortPixelAI.observedMutations++;ShortPixelAI.mutationsList[ShortPixelAI.xpath(e.target)]={target:e.target,time:(new Date).getTime()};ShortPixelAI.timeOutHandle=setTimeout(ShortPixelAI.processMutations,50)}}}))}));var e=document.querySelector("body");var t={attributes:true,childList:true,subtree:true,characterData:true};ShortPixelAI.mutationObserver.observe(e,t)};SPAI.prototype.processMutations=function(){var e=0;for(var t in ShortPixelAI.mutationsList){var r=jQuery(ShortPixelAI.mutationsList[t].target);if(ShortPixelAI.mutationsList[t].time+50>(new Date).getTime()){e++;continue}var i=r[0].outerHTML;if(r.length&&ShortPixelAI.containsPseudoSrc(i)>0){ShortPixelAI.handleUpdatedImageUrlsWithRetry(false,r,true,false);if(i.indexOf("background")>0){ShortPixelAI.updateInlineStyle(r,false,false,!ShortPixelAI.is(r,ShortPixelAI.EXCLUDED))}}delete ShortPixelAI.mutationsList[t]}ShortPixelAI.mutationsLastProcessed=(new Date).getTime();if(e>0){ShortPixelAI.timeOutHandle=setTimeout(ShortPixelAI.processMutations,50)}};SPAI.prototype.setupIntersectionObserverAndParse=function(){var e={rootMargin:ShortPixelAI.intersectionMargin+"px",threshold:0};ShortPixelAI.intersectionObserver=new IntersectionObserver((function(e,t){e.forEach((function(e){if(e.isIntersecting){var r=jQuery(e.target);ShortPixelAI.handleUpdatedImageUrlsWithRetry(false,r,true,true);if(e.target.outerHTML.indexOf("background")>0){ShortPixelAI.updateInlineStyle(r,false,false,!ShortPixelAI.is(r,ShortPixelAI.EXCLUDED))}t.unobserve(e.target);ShortPixelAI.triggerEvent("spai-element-handled",e.target)}else if(spai_settings.debug){var r=jQuery(e.target);ShortPixelAI.log(r[0].nodeName+" is NOT intersecting - "+ShortPixelAI.parsePseudoSrc(r[0].src).src)}}))}),e);jQuery("style").each((function(){var e=jQuery(this);try{var t=ShortPixelAI.replaceBackgroundPseudoSrc(e.html());if(t.replaced){e.html(t.text)}}catch(e){spai_settings.debug&&ShortPixelAI.log("error "+e.description)}}));jQuery("style").each((function(){var e=jQuery(this);try{var t=ShortPixelAI.replaceBackgroundPseudoSrc(e.html());if(t.replaced){e.html(t.text)}}catch(t){spai_settings.debug&&ShortPixelAI.log("Error parsing styles: "+t.description+" (STYLE TAG: "+e.html()+")")}}));if(!navigator.platform||!/iPad|iPhone|iPod/.test(navigator.platform)){for(var t in document.styleSheets){var r=document.styleSheets[t];try{for(var i in r.rules){var o=r.rules[i];if(typeof o.cssText!=="undefined"&&ShortPixelAI.containsPseudoSrc(o.cssText)>0){var a=ShortPixelAI.replaceBackgroundPseudoSrc(o.cssText);if(a.replaced){o.cssText=a.text;document.styleSheets[t].removeRule(i);document.styleSheets[t].insertRule(a.text,i)}}}}catch(e){}}}ShortPixelAI.handleBody();if(typeof window.MutationObserver!=="function"){jQuery.getScript(spai_settings.plugin_url+"/assets/js/MutationObserver.min.js?"+spai_settings.version,ShortPixelAI.setupDOMChangeObserver)}else{ShortPixelAI.setupDOMChangeObserver()}};SPAI.prototype.replaceBackgroundPseudoSrc=function(e){var t=false;e.replace(/background(-image|)\s*:([^;]*[,\s]|\s*)url\(['"]?(data:image\/svg\+xml[^'"\)]*?)(['"]?)\)/gm,(function(r){var i=/background(-image|)\s*:([^;]*[,\s]|\s*)url\(['"]?(data:image\/svg\+xml[^'"\)]*?)(['"]?)\)/m;var o=i.exec(r);var a=ShortPixelAI.parsePseudoSrc(o[3]);var n=window.screen.width;var s=spai_settings.backgrounds_max_width?spai_settings.backgrounds_max_width:99999;var l=ShortPixelAI.composeApiUrl(false,a.src,Math.min(a.origWidth,n,s),false);e=e.replace(o[3],l);t=true}));return{text:e,replaced:t}};SPAI.prototype.elementInViewport=function(e,t){if(!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)){return false}var r=e.getBoundingClientRect();return r.bottom+t>=0&&r.right+t>=0&&r.top-t<=(window.innerHeight||document.documentElement.clientHeight)&&r.left-t<=(window.innerWidth||document.documentElement.clientWidth)};SPAI.prototype.hookIntoFancybox=function(e){if(ShortPixelAI.fancyboxId.length==0||ShortPixelAI.fancyboxHooked!=="none"){return}var t=jQuery(e);var r=jQuery("a#fancybox-right",t);r.mousedown((function(e){var t=ShortPixelAI.fancyboxChangeId(1);var r=jQuery("div#"+t+" a.ngg-fancybox");if(r.length){ShortPixelAI.fancyboxUpdateWidth(r)}}));var r=jQuery("a#fancybox-left",t);r.mousedown((function(e){var t=ShortPixelAI.fancyboxChangeId(-1);var r=jQuery("div#"+t+" a.ngg-fancybox");if(r.length){ShortPixelAI.fancyboxUpdateWidth(r)}}));ShortPixelAI.fancyboxHooked=ShortPixelAI.fancyboxId};SPAI.prototype.fancyboxChangeId=function(e){var t=ShortPixelAI.fancyboxId.match(/(.*)([0-9]+)$/);return t[1]+(parseInt(t[2])+e)};SPAI.prototype.composeApiUrl=function(e,t,r,i){if(!t.match(/^http[s]{0,1}:\/\/|^\/\//)){if(t.startsWith("/")){if(typeof ShortPixelAI.aHref==="undefined"){ShortPixelAI.aHref=document.createElement("a")}ShortPixelAI.aHref.href=spai_settings.site_url;t=ShortPixelAI.aHref.protocol+"//"+ShortPixelAI.aHref.hostname+t}else{var o=window.location.href.split("#")[0].split("?")[0];if(!o.endsWith("/")){var a=o.split("/");a.pop();o=a.join("/")+"/"}t=o+t;if(t.indexOf("..")>0){var n=document.createElement("a");n.href=t;t=n.protocol+"//"+n.hostname+(n.pathname.startsWith("/")?"":"/")+n.pathname+n.search+n.hash}}}var s=/(?:\.([^.\/\?]+))(?:$|\?.*)/;s.lastIndex=0;var l=s.exec(t);var d=typeof l==="object"&&l!==null&&typeof l[1]==="string"&&l[1]!==""?l[1]:"jpg";d=d==="jpeg"?"jpg":d;if(d==="svg"){r=i=0}if(r>1&&r<99999){var h=typeof window.devicePixelRatio==="undefined"?1:window.devicePixelRatio;r=Math.round(r*h);i=i?Math.round(i*h):undefined;if(ShortPixelAI.urlRegister[t]===undefined||ShortPixelAI.urlRegister[t].width<r){if(e){ShortPixelAI.urlRegister[t]={width:r,height:i}}}else if(!ShortPixelAI.urlRegister[t].height&&!i||!!ShortPixelAI.urlRegister[t].height&&!!i&&Math.abs(1-r*ShortPixelAI.urlRegister[t].height/i/ShortPixelAI.urlRegister[t].width)<.005){i=ShortPixelAI.urlRegister[t].height;r=ShortPixelAI.urlRegister[t].width}var u=spai_settings.api_url.replace("%WIDTH%",""+r+(i?"+h_"+i:""))}else{var u=spai_settings.api_url.replace("w_%WIDTH%"+spai_settings.sep,"");u=u.replace("w_%WIDTH%","")}switch(d){case"svg":u=spai_settings.serve_svg?spai_settings.api_short_url+"/"+t:t;break;case"png":u=u+(ShortPixelAI.supportsWebP&&spai_settings.extensions_to_webp.png?spai_settings.sep+"to_webp":"")+"/"+t;break;case"jpg":u=u+(ShortPixelAI.supportsWebP&&spai_settings.extensions_to_webp.jpg?spai_settings.sep+"to_webp":"")+"/"+t;break;case"gif":u=u+(ShortPixelAI.supportsWebP&&spai_settings.extensions_to_webp.gif?spai_settings.sep+"to_webp":"")+"/"+t;break;default:u=u+(ShortPixelAI.supportsWebP?spai_settings.sep+"to_webp":"")+"/"+t;break}return u};SPAI.prototype.isFullPseudoSrc=function(e){return this.parsePseudoSrc(e).full};SPAI.prototype.containsPseudoSrc=function(e){return e.indexOf("data:image/svg+xml;")>=0};SPAI.prototype.parsePseudoSrc=function(e){var t={src:false,origWidth:0,origHeight:0,full:false},r=/([A-Za-z0-9+/]{4})*([A-Za-z0-9+/]{3}=|[A-Za-z0-9+/]{2}==)?$/;if(typeof e==="undefined"||!this.containsPseudoSrc(e)){return t}var i,o,a;e=e.trim();if(typeof e==="string"){a=e.match(r);a=a.length>0?a[0]:undefined;if(typeof a==="string"){o=atob(a)}}try{if(typeof o==="string"){i=jQuery(o)}}catch(e){spai_settings.debug&&ShortPixelAI.log("svgDecoded: "+o);return t}if(i instanceof jQuery){var n={url:i.data("u"),width:i.data("w"),height:i.data("h")};t.src=n.url===undefined||n.url===""?t.src:ShortPixelAI.urldecode(n.url);if(t.src!==""&&typeof t.src==="string"){if(t.src.lastIndexOf("//",0)===0){t.src=window.location.protocol+t.src}}t.origWidth=n.width===undefined||n.width===""?t.origWidth:n.width;t.origHeight=n.height===undefined||n.height===""?t.origHeight:n.height;t.full=typeof t.src==="string"&&t.src!==""}return t};SPAI.prototype.updateSrc=function(e,t,r,i,o,a){var n=e.attr("data-spai-"+t+"-meta");if(typeof n==="undefined"){var n=e.attr(t);if(typeof n==="undefined"){return false}}var s=ShortPixelAI.parsePseudoSrc(n);var l=s?s.src:false;if(!l){return false}s.crop=false;var d=e.attr("data-spai-crop");if(typeof d!=="undefined"&&d==="true"){s.crop=true}if(typeof a==="undefined"||!a){if(i>s.origHeight*r/s.origWidth){if(spai_settings.crop==="1"){s.crop=true}else{r=Math.round(s.origWidth*i/s.origHeight)}}}else{if(i<s.origHeight*r/s.origWidth){r=Math.round(s.origWidth*i/s.origHeight)}}s.newWidth=s.origWidth>1?Math.min(s.origWidth,r):r;var h=o?ShortPixelAI.composeApiUrl(t=="src"&&e.is("img"),l,s.newWidth,s.crop?i:false):l;e.attr(t,h);e.removeAttr("data-spai-"+t+"-meta");return s};SPAI.prototype.updateSrcSet=function(e,t,r){var i=e.attr("srcset");var o=e.attr("sizes");var a=ShortPixelAI.parsePseudoSrcSet(i,o,t,r);if(a.srcSet.length){e.attr("srcset",a.srcSet)}if(a.sizes.length){e.attr("sizes",a.sizes)}};SPAI.prototype.parsePseudoSrcSet=function(e,t,r,i){var o="";var a="";if(e){var n=e.match(/[^\s,][^\s]+(\s+[0-9wpx]+\s*,?|\s*,|\s*$)/g);for(var s=0;s<n.length;s++){var l=n[s].replace(/,$/,"").trim();var d="";var h=l.split(/\s+/);if(this.isFullPseudoSrc(h[0])){var h=l.split(/\s+/);if(h.length>=2){var u=ShortPixelAI.parsePseudoSrc(h[0]);if(u.src){d=ShortPixelAI.composeApiUrl(false,u.src,false,false)+" "+h[1]}if(r==parseInt(h[1])){i=false}else if(i&&r<parseInt(h[1])){o+=ShortPixelAI.composeApiUrl(false,i.src,r,false)+" "+r+"w,";i=false}}}if(!d.length){d=l}o+=d+", "}o=o.replace(/,+\s+$/,"")}else if(i&&spai_settings.method=="srcset"&&r<i.origWidth*.9){o=ShortPixelAI.composeApiUrl(false,i.src,r,false)+" "+r+"w, "+i.src+" "+i.origWidth+"w";a=Math.round(100*r/i.origWidth)+"vw, 100vw"}return{srcSet:o,sizes:a}};SPAI.prototype.removeSrcSet=function(e){var t=e.attr("srcset");if(typeof t!=="undefined"&&t.length){e.attr("srcset","");e.attr("sizes","")}};SPAI.prototype.updateInlineStyle=function(e,t,r,i){var o=e.attr("style");var a=ShortPixelAI.getBackgroundPseudoImages(e.attr("style"));var n=[];if(!a)return;for(var s=0;s<a.length;s++){var l=ShortPixelAI.parsePseudoSrc(a[s]);var d=l?l.src:false;if(d){while(d.charAt(0)=='"'){d=d.substring(1)}while(d.charAt(d.length-1)=='"'){d=d.substring(0,d.length-1)}}else{return false}var h=window.screen.width;var u=spai_settings.backgrounds_max_width?spai_settings.backgrounds_max_width:99999;var p=l.origWidth>0?l.origWidth:99999;var c=Math.min(p,h,t?t:99999,u);var f=window.screen.height;var g=l.origHeight>0?l.origHeight:99999;var I=g<99999?Math.min(g,f,r?r:99999):99999;var A=i?ShortPixelAI.composeApiUrl(false,d,c<99999?c:false,!!spai_settings.crop&&I<99999?I:false):d;e.attr("style",o.replace(a[s],A));o=e.attr("style");n.push(l)}return n.length>0?n:false};SPAI.prototype.getBackgroundPseudoImages=function(e){if(typeof e==="undefined"||e.indexOf("background")<0){return false}var t=/(background-image|background)\s*:([^;]*[,\s]|\s*)url\(['"]?([^'"\)]*?)(['"]?)\)/gm,r,i=[];while((r=t.exec(e))!==null){if(!r||r.length<3){return false}if(r[3].indexOf("data:image")>=0){i.push(r[3])}}return i.length>0?i:false};SPAI.prototype.urldecode=function(e){return decodeURIComponent((e+"").replace(/\+/g,"%20"))};SPAI.prototype.getSizesRecursive=function(e,t){if(!e.is(":visible")&&t){throw{type:"defer",cause:"invisible"}}var r=window.getComputedStyle(e[0]);var i=r["width"];var o=r["height"];var a=parseFloat(i);var n=parseFloat(o);if(i=="0px"&&e[0].nodeName!=="A"){throw{type:"defer",cause:"width 0"}}if(i.slice(-1)=="%"){if(typeof e.parent()==="undefined")return{width:-1};var s=ShortPixelAI.getSizesRecursive(e.parent(),t);if(s==-1)return{width:-1,padding:0};a=s.width*a/100;if(o.slice(-1)=="%"){n=s.height*n/100}}else if(a<=1){if(e[0].tagName==="IMG"&&typeof e.attr("width")!=="undefined"&&typeof e.attr("height")!=="undefined"){a=parseInt(e.attr("width"));n=parseInt(e.attr("height"))}else{if(typeof e.parent()==="undefined")return{width:-1,padding:0};var s=ShortPixelAI.getSizesRecursive(e.parent(),t);if(s.width==-1)return{width:-1,padding:0};a=s.width;n=s.height}a-=ShortPixelAI.percent2px(r["margin-left"],a)+ShortPixelAI.percent2px(r["margin-right"],a);n-=ShortPixelAI.percent2px(r["margin-top"],n)+ShortPixelAI.percent2px(r["margin-bottom"],n)}var l=ShortPixelAI.percent2px(r["padding-left"],a)+ShortPixelAI.percent2px(r["padding-right"],a)+ShortPixelAI.percent2px(r["border-left-width"],a)+ShortPixelAI.percent2px(r["border-right-width"],a);var d=ShortPixelAI.percent2px(r["padding-top"],n)+ShortPixelAI.percent2px(r["padding-bottom"],n)+ShortPixelAI.percent2px(r["border-top-width"],n)+ShortPixelAI.percent2px(r["border-bottom-width"],n);return{status:"success",width:a-l,height:n-d,padding:l,padding_height:d}};SPAI.prototype.percent2px=function(e,t){return e.slice(-1)=="%"?t*parseFloat(e)/100:parseFloat(e)};SPAI.prototype.fancyboxUpdateWidth=function(e){var t=jQuery.extend({},jQuery.fn.fancybox.defaults,typeof e.data("fancybox")=="undefined"?{}:e.data("fancybox"));var r=[jQuery(window).width()-t.margin*2,jQuery(window).height()-t.margin*2,jQuery(document).scrollLeft()+t.margin,jQuery(document).scrollTop()+t.margin];var i=t.padding*2;var o=r[0]-i;var a=r[1]-i;var n=t.width/t.height;var s=o/a;var l=0;var d=0;if(n>s){l=o}else{d=a;l=Math.round(a*n)}l=l<700?Math.floor((l+49)/50)*50:Math.floor((l+99)/100)*100;var h=e.attr("href");if(h.indexOf("w_DEFER")>0){var u=h.replace("w_DEFER","w_"+l);e.attr("href",u)}else{var p=h.match(/\/w_([0-9]+),._/g);if(p!==null&&p[2]<l){var u=h.replace(/\/w_[0-9]+,/,"/w_"+l+",");e.attr("href",u)}else{return}}ShortPixelAI.fancyboxId=e.parent().parent().attr("id")};SPAI.prototype.xpath=function(e){if(typeof e=="string")return document.evaluate(e,document,null,0,null);if(!e||e.nodeType!=1)return"";if(e.id)return"//*[@id='"+e.id+"']";var t=[];try{t=e.parentNode===null||typeof e.parentNode.children==="undefined"?[]:[].filter.call(e.parentNode.children,(function(t){return t.tagName==e.tagName}))}catch(e){}return(e.parentNode===null?"":ShortPixelAI.xpath(e.parentNode)+"/")+e.tagName.toLowerCase()+(t.length>1?"["+([].indexOf.call(t,e)+1)+"]":"")};SPAI.prototype.registerCallback=function(e,t){ShortPixelAI.callbacks[e]=t};SPAI.prototype.elementUpdated=function(e,t){e.attr("data-spai-upd",Math.round(t));ShortPixelAI.updatedUrlsCount++;if(typeof ShortPixelAI.callbacks["element-updated"]!=="undefined"){ShortPixelAI.callbacks["element-updated"](e)}};SPAI.prototype.triggerEvent=function(e,t){const r=document.createEvent("Event");r.initEvent(e,true,true);spai_settings.debug&&console.log("Event "+e+" triggered on "+t.tagName);t.dispatchEvent(r)};if(!String.prototype.startsWith){String.prototype.startsWith=function(e,t){t=t||0;return this.substr(t,e.length)===e}}var shortPixelAIonDOMLoadedTimeout=false;var shortPixelAIonDOMLoadedCounter=0;window.ShortPixelAI=new SPAI;function shortPixelAIonDOMLoaded(){if(ShortPixelAI.initialized)return;if(typeof spai_settings==="undefined"){if(shortPixelAIonDOMLoadedCounter>50){return}clearTimeout(shortPixelAIonDOMLoadedTimeout);shortPixelAIonDOMLoadedTimeout=setTimeout(shortPixelAIonDOMLoaded,shortPixelAIonDOMLoadedCounter>20?30:10);shortPixelAIonDOMLoadedCounter++;return}spai_settings.excluded_paths=spai_settings.excluded_paths.map(atob);if(spai_settings.native_lazy!="1"){var e="(googlebot/|Googlebot-Mobile|Googlebot-Image|Google favicon|Mediapartners-Google|bingbot|slurp|java|wget|curl|Commons-HttpClient|Python-urllib|libwww|httpunit|nutch|phpcrawl|msnbot|jyxobot|FAST-WebCrawler|FAST Enterprise Crawler|biglotron|teoma|convera|seekbot|gigablast|exabot|ngbot|ia_archiver|GingerCrawler|webmon |httrack|webcrawler|grub.org|UsineNouvelleCrawler|antibot|netresearchserver|speedy|fluffy|bibnum.bnf|findlink|msrbot|panscient|yacybot|AISearchBot|IOI|ips-agent|tagoobot|MJ12bot|dotbot|woriobot|yanga|buzzbot|mlbot|yandexbot|purebot|Linguee Bot|Voyager|CyberPatrol|voilabot|baiduspider|citeseerxbot|spbot|twengabot|postrank|turnitinbot|scribdbot|page2rss|sitebot|linkdex|Adidxbot|blekkobot|ezooms|dotbot|Mail.RU_Bot|discobot|heritrix|findthatfile|europarchive.org|NerdByNature.Bot|sistrix crawler|ahrefsbot|Aboundex|domaincrawler|wbsearchbot|summify|ccbot|edisterbot|seznambot|ec2linkfinder|gslfbot|aihitbot|intelium_bot|facebookexternalhit|yeti|RetrevoPageAnalyzer|lb-spider|sogou|lssbot|careerbot|wotbox|wocbot|ichiro|DuckDuckBot|lssrocketcrawler|drupact|webcompanycrawler|acoonbot|openindexspider|gnam gnam spider|web-archive-net.com.bot|backlinkcrawler|coccoc|integromedb|content crawler spider|toplistbot|seokicks-robot|it2media-domain-crawler|ip-web-crawler.com|siteexplorer.info|elisabot|proximic|changedetection|blexbot|arabot|WeSEE:Search|niki-bot|CrystalSemanticsBot|rogerbot|360Spider|psbot|InterfaxScanBot|Lipperhey SEO Service|CC Metadata Scaper|g00g1e.net|GrapeshotCrawler|urlappendbot|brainobot|fr-crawler|binlar|SimpleCrawler|Livelapbot|Twitterbot|cXensebot|smtbot|bnf.fr_bot|A6-Indexer|ADmantX|Facebot|Twitterbot|OrangeBot|memorybot|AdvBot|MegaIndex|SemanticScholarBot|ltx71|nerdybot|xovibot|BUbiNG|Qwantify|archive.org_bot|Applebot|TweetmemeBot|crawler4j|findxbot|SemrushBot|yoozBot|lipperhey|y!j-asr|Domain Re-Animator Bot|AddThis)";var t=new RegExp(e,"i");var r=navigator.userAgent;if(t.test(r)){spai_settings.native_lazy="1"}}else if(!("loading"in document.createElement("img"))){spai_settings.native_lazy=""}ShortPixelAI.initialized=true;if(spai_settings.webp=="1"&&self.createImageBitmap){var i=function(){var e={basic:"data:image/webp;base64,UklGRjIAAABXRUJQVlA4ICYAAACyAgCdASoCAAEALmk0mk0iIiIiIgBoSygABc6zbAAA/v56QAAAAA==",lossless:"data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="};return function(t){function r(){this._done=[];this._fail=[]}r.prototype={execute:function(e,t){var r=e.length;t=Array.prototype.slice.call(t);while(r--)e[r].apply(null,t)},promise:function(){return this},resolve:function(){this.execute(this._done,arguments)},reject:function(){this.execute(this._fail,arguments)},then:function(e,t){this._done.push(e);this._fail.push(t)},done:function(e){this._done.push(e);return this},fail:function(e){this._fail.push(e);return this}};var i=new r;var o=new Image;o.onload=function(){if(this.width===2&&this.height===1){i.resolve()}else{i.reject()}};o.onerror=i.reject;o.src=e[t||"basic"];return i.promise()}}();i().then((function(){ShortPixelAI.supportsWebP=true;ShortPixelAI.init()}),(function(){ShortPixelAI.init()}))}else{ShortPixelAI.init()}if(document.getElementById("shortpixel_ai_sniper")!==null){document.getElementById("shortpixel_ai_sniper").setAttribute("onclick","SpaiSniper(1);return false;")}}if(document.readyState==="loading"){document.addEventListener("DOMContentLoaded",(function(){shortPixelAIonDOMLoaded()}))}else{shortPixelAIonDOMLoaded()}